<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jeonguggu.matnam.user.store.StoreMpp">
<resultMap id="resultMapObj" type="com.jeonguggu.matnam.user.store.Store"></resultMap>

	<select id="selectListStore" resultMap="resultMapObj">
		SELECT
			a.mnrtSeq
			,a.mnrtName
		    ,a.mnrtAddressFull
		    ,a.mnrtAvg
            ,a.mnrtX
            ,a.mnrtY
            ,b.mncdName
		FROM matnam.matnamRestaurant a
        	left join matnam.matnamCode b on b.mncdSeq = a.mnrtFoodCateCd
         	left join matnam.matnamCode c on c.mncdSeq = a.mnrtHolidayCd;
		
	</select>
	
	<select id="selectOneStore" resultMap="resultMapObj">
		SELECT
			a.mnrtName
			,a.mnrtSeq
			,a.mnrtAddressFull
		    ,a.mnrtFoodCateCd
		    ,a.mnrtTime
		    ,a.mnrtBreakTime
		    ,a.mnrtHolidayCd
		    ,a.mnrtText
		    ,a.mnrtNumber
		    ,a.mnrtAvg
            ,b.mncdName as mnrtFoodCate
            ,c.mncdName as mnrtHoliday
		FROM matnam.matnamRestaurant a
        	left join matnam.matnamCode b on b.mncdSeq = a.mnrtFoodCateCd
         	left join matnam.matnamCode c on c.mncdSeq = a.mnrtHolidayCd
		WHERE 1=1
			AND a.mnrtSeq = #{mnrtSeq};
	</select>
	
	<select id="selectListReview" resultMap="resultMapObj">
		SELECT
			a.mnrtSeq
			,a.mnrvSeq
			,a.mnMmSeq
			,a.mnrvScore
	        ,a.mnrvText
	        ,a.regDateTime
	        ,b.mnMmName
            ,c.uuidName
            ,c.path
	    FROM matnam.matnamReview a
	    left join matnam.matnamMember b ON b.mnMmSeq = a.mnMmSeq
        left join matnam.matnamUploaded c on c.pseq = b.mnMmSeq
	    where 1=1
	    and mnrtSeq = #{mnrtSeq}
        and defaultNy = 1;
	</select>
	
	<select id="selectOneReview" resultMap="resultMapObj">
		select 
			a.mnrtSeq
			,a.mnMmSeq
			,a.mnrvScore
			,a.mnrvText
			,b.mnMmName
		from matnam.matnamReview a
		left join matnam.matnamMember b on b.mnMmSeq = a.mnMmSeq
		where 1=1
		and a.mnrtSeq = #{mnrtSeq}
		and a.mnMmSeq = #{mnMmSeq};
	</select>
	
	<select id="selectCountReview" resultType="Integer">
		select 
			count(*)
		from matnamReview 
		where 1=1
			and mnrtSeq = #{mnrtSeq};
		
	</select>
	
	<select id="selectAvg" resultType="Integer">
		select
			avg(mnrvScore)
		from matnam.matnamReview
		where 1=1
			and mnrtSeq = 1;
	
	</select>
	
	
	<!-- 등록  -->
	<insert id="insertReview">
		insert into matnam.matnamReview(
			mnrvText
	        ,mnrvDelNy
	        ,mnrtSeq
	        ,mnMmSeq
	        ,mnmSeq
	        ,mnrvScore
	        ,regDateTime
	    )value(
			#{mnrvText}
			,0
	        ,#{mnrtSeq}
	        ,#{mnMmSeq}
	        ,0
	        ,#{mnrvScore}
	        ,now()
	    );
    </insert>
	<!-- 등록  -->
	
	
	
	<!-- 업데이트  -->
	
	<update id="updateReview">
			UPDATE matnam.matnamReview SET 
				mnrvText  = #{mnrvText}
			WHERE 1=1
				AND mnrtSeq = #{mnrtSeq}
                AND mnMmSeq = #{mnMmSeq};
	</update>
	<!-- 업데이트  -->
	
	
	
	<!-- 삭제  -->
	
	<delete id="deleteReview">
		DELETE 
    	FROM matnam.matnamReview
		WHERE 1=1
			AND mnrtSeq = #{mnrtSeq}
			AND mnMmSeq = #{mnMmSeq}
			AND mnrvSeq = #{mnrvSeq};
	</delete>
	<!-- 삭제  -->	


</mapper>