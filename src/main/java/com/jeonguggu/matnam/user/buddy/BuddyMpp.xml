<?xml version="1.0" encoding="UTF-8" ?>
 
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jeonguggu.matnam.user.buddy.BuddyMpp">

    <resultMap id="resultMapObj" type="com.jeonguggu.matnam.user.buddy.Buddy"></resultMap>
	
    <!-- 친구목록 조회 시작 -->
	<select id="selectListFriend" resultMap="resultMapObj">
		<!-- SELECT
			a.mnMmSeq
			,a.mnMmName
			,a.mnMmIntroduce
			,b.mnfdFriendSeq AS sendFriendSeq
    		,c.mnfdFriendSeq AS receiveFriendSeq
		FROM
			matnamMember a
			LEFT JOIN matnamFriend b ON b.mnfdDelNy = 0 AND a.mnMmSeq = b.mnfdFriendSeq AND b.mnfdFriendStateCd = 4
			LEFT JOIN matnamFriend c ON c.mnfdDelNy = 0 AND a.mnMmSeq = c.mnMmSeq AND c.mnfdFriendStateCd = 4
		WHERE 1=1
			AND b.mnMmSeq = #{mnMmSeq}
			OR c.mnfdFriendSeq = #{mnMmSeq} -->
		SELECT
			b.mnfdSeq
			,a.mnMmName
		    ,b.mnMmSeq
		    ,b.mnfdFriendSeq
		FROM
			matnamFriend b
		    LEFT JOIN matnamMember a ON b.mnMmSeq = a.mnMmSeq OR b.mnfdFriendSeq = a.mnMmSeq
		WHERE 1=1
			AND NOT a.mnMmName = #{mnMmName}
			AND b.mnfdFriendStateCd = 4
			AND b.mnMmSeq = #{mnMmSeq}
		    OR b.mnfdFriendSeq = #{mnMmSeq}
		    AND NOT a.mnMmName = #{mnMmName}
	</select>
	<!-- 친구 목록 조회 끝 -->
	
	<!-- 차단친구목록 조회 시작 -->
	<select id="selectListFriendBlock" resultMap="resultMapObj">
		SELECT
			a.mnMmSeq
			,a.mnMmName
			,a.mnMmIntroduce
		FROM
			matnamMember a
			LEFT JOIN matnamFriend b ON b.mnfdDelNy = 0 AND a.mnMmSeq = b.mnfdFriendSeq AND b.mnfdFriendStateCd = 5
			LEFT JOIN matnamFriend c ON c.mnfdDelNy = 0 AND a.mnMmSeq = c.mnMmSeq AND c.mnfdFriendStateCd = 5
		WHERE 1=1
			AND b.mnMmSeq = #{mnMmSeq}
			OR c.mnfdFriendSeq = #{mnMmSeq}
	</select>
	<!-- 차단친구 목록 조회 끝 -->
	
	<!-- 받은 친구요청 목록 조회 시작 -->
	<select id="selectListUserFriendRequestReceive" resultMap="resultMapObj">
		SELECT
			a.mnMmSeq
			,a.mnMmName
			,a.mnMmIntroduce
			,c.mnfdMessage
		FROM
			matnamMember a
			LEFT JOIN matnamFriend c ON c.mnfdDelNy = 0 AND a.mnMmSeq = c.mnMmSeq AND c.mnfdFriendStateCd = 6
		WHERE 1=1
			AND c.mnfdFriendSeq = #{mnMmSeq}
	</select>
	<!-- 받은 친구요청 목록 조회 끝 -->
	
	<!-- 보낸 친구요청 목록 조회 시작 -->
	<select id="selectListUserFriendRequestSend" resultMap="resultMapObj">
		SELECT
			a.mnMmSeq
			,a.mnMmName
			,a.mnMmIntroduce
			,b.mnfdMessage
		FROM
			matnamMember a
			LEFT JOIN matnamFriend b ON b.mnfdDelNy = 0 AND a.mnMmSeq = b.mnfdFriendSeq AND b.mnfdFriendStateCd = 6
		WHERE 1=1
			AND b.mnMmSeq = #{mnMmSeq}
	</select>
	<!-- 보낸 친구요청 목록 조회 끝 -->
	
	<!-- 매칭 목록 조회 시작 -->
	<!-- =============================임시======================= -->
	<select id="selectListArea" resultMap="resultMapObj">
		SELECT
			a.mnMmSeq
			,a.mnMmName
			,a.mnMmIntroduce
			,a.mnMmDob_Year
			,a.mnMmGenderCd
			,a.mnMmLike
			,b.mnmaAddress1
		FROM
			matnamMember a
			LEFT JOIN matnamMemberAddress b ON b.mnmaDelNy = 0  AND b.mnmaDefaultNy = 1 AND b.mnMmSeq = a.mnMmSeq
		WHERE 1=1
			AND b.mnmaAddress1 LIKE concat('%',#{mnmaAddress1},'%')
			<choose>
				<when test="mnMmSeq != null and !mnMmSeq.equals('')">AND a.mnMmSeq != #{mnMmSeq}</when>
			</choose>
	</select>
	<!-- 매칭 목록 조회 끝 -->
    
    <!-- 사용자 프로필 조회 시작 -->
    <select id="selectOneUser" resultMap="resultMapObj">
		SELECT
			a.mnMmSeq
			,a.mnMmId
			,a.mnMmName
			,c.mnmpNumber
			,a.mnMmEmail
			,a.mnMmIntroduce
			,b.mnmaAddress1
		FROM
			matnamMember a
			LEFT JOIN matnamMemberAddress b ON b.mnmaDelNy = 0  AND b.mnmaDefaultNy = 1 AND b.mnMmSeq = a.mnMmSeq
			LEFT JOIN matnamMemberPhone c ON c.mnmpDelNy = 0  AND c.mnmpDefaultNy = 1 AND c.mnMmSeq = a.mnMmSeq
		WHERE 1=1
			AND a.mnMmSeq = #{mnMmSeq}
	</select>
    <!-- 사용자 프로필 조회 끝 -->
</mapper>